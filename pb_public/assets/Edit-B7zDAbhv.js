import{r as n,m as V,A,c as i,b as v,d as b,a as l,t as w,u as S,F,f as B,g as h,o as c,L,n as N,j as q,q as I,k as P}from"./index-DhUzF4e6.js";import{s as _,t as z}from"./utils-RVpx9FsL.js";import{S as K}from"./sweetalert2.esm.all-CIewtpap.js";import{B as T}from"./BreadCrumb-QusY3eB5.js";import"./index.esm-DyswK6GF.js";const G={key:0,class:"mt-4"},H={key:1},J={class:"card mt-3"},M={class:"card-content"},Q={class:"has-text-weight-bold"},U={class:"columns is-multiline"},W={key:2,class:"mt-4"},X={class:"has-text-danger"},se={__name:"Edit",props:{parentRoute:String,label:String},setup(C){const u=C,f=n(!1),d=n(null),m=n(null),a=I(),E=P(),g=n([]),y=n({}),r=n(null);V(()=>[a.params.id,a.params.query],$,{immediate:!0}),A(()=>{const t=[{label:"Dashboard",path:"/",isActive:!1},{label:u.label,path:`/${u.parentRoute}/collection/${a.params.id}`,isActive:!1},{label:_(a.params.id),path:`/${u.parentRoute}/collection/${a.params.id}`,isActive:!1},{label:"Edit",path:`/settings/collection/${a.params.id}/add`,isActive:!0}];g.value=t});async function $(){d.value=m.value=null,f.value=!0;try{const t=await h.send(`/api/get_collection/${a.params.id}`);d.value=t.collection;const s=await h.collection(a.params.id).getOne(a.params.collectionID);r.value=s}catch{m.value="something bad occured"}finally{f.value=!1}}function D(t){let s=t.map(e=>(e.label=_(e.name),e.placeholder=e.name,e.type==="select"&&(e.options=e.values.map(o=>({label:o,value:o}))),e.type==="relation"&&(e.type="relational_field_select",e.collection=e.name,e.collection==="employee"?(e.isCombinedField=!0,e.combinedFields=["first_name","middle_name","last_name"],e.labelField="first_name"):e.labelField="name",e.firstOption=`select ${e.name}`),e));return s=s.filter(e=>{if(e.name!=="tokenKey"&&e.type!=="autodate"&&e.name!=="id")return e}),a.params.id==="users"&&s.splice(1,0,{name:"passwordConfirm",label:"Password Confirm",type:"password",placeholder:"password confirm"}),s}async function O(t){t.preventDefault();const s=t.target,e=new FormData(s);let o=Object.fromEntries(e.entries());o=z(o),console.log(Object.fromEntries(o.entries()));try{const p=await h.collection(a.params.id).update(a.params.collectionID,o);console.log(p),K.fire({title:"Success!",text:"successfully updated",icon:"success"}),E.push(`/${u.parentRoute}/collection/${a.params.id}`)}catch(p){if(p.data.data){const k={};Object.entries(p.data.data).forEach(([x,R])=>{k[x]=R.message}),y.value=k}}}function j(t){return console.log(t.name,r.value),r.value&&r.value[t.name]!==void 0?r.value[t.name]:""}return(t,s)=>(c(),i(F,null,[v(T,{links:g.value},null,8,["links"]),f.value?(c(),i("div",G,[v(L)])):b("",!0),d.value!==null&&r.value!=null?(c(),i("div",H,[l("div",J,[l("div",M,[l("form",{novalidate:"",onSubmit:O},[l("legend",Q," Edit "+w(S(_)(S(a).params.id)),1),s[0]||(s[0]=l("div",{class:"is-flex is-flex-direction-row-reverse"},[l("button",{class:"button is-dark",type:"submit"}," Save ")],-1)),l("div",U,[(c(!0),i(F,null,B(D(d.value.fields),e=>(c(),i("div",{class:N(["column",e.type==="editor"?"is-12":"is-4"])},[v(q,{form:e,errors:y.value,defaultValue:j(e)},null,8,["form","errors","defaultValue"])],2))),256))])],32)])])])):b("",!0),m.value!==null?(c(),i("div",W,[l("p",X,w(m.value),1)])):b("",!0)],64))}};export{se as default};
