import{l as I,r as k,b as M,o as e,c as l,a as t,t as f,u as y,k as a,F as D,f as j,h as T,n as z,j as E,e as P,_ as G,i as J,p as W,m as X,d as N,g as R,q as Z,w as H,x as ee,R as te}from"./index-C7IYLqTz.js";import{c as q}from"./BreadCrumb-TF3kDMJB.js";import{L as le}from"./LoadingSkeleton-DhLAkGpz.js";import{t as se}from"./forms-uoaoRhcW.js";import{S}from"./sweetalert2.esm.all-DPo3DB14.js";import{v as oe}from"./index-Cfw59jWj.js";const ne={class:"field"},ae=["for"],ie={class:"control"},ce={class:"select is-small",style:{width:"100%"}},re=["name","id"],ue={key:0,value:""},de={key:1,value:""},fe={key:2,value:""},_e=["value","selected"],pe={__name:"DynamicSelect",props:{item:Object},setup(B){const g=I(),_=B;let d=k(null),b=k(!1);return M(async()=>{try{const p=await q.collection(_.item.collection).getFullList({});d.value=p}catch(p){console.log(p.data),b.value=!0}}),(p,x)=>(e(),l("div",ne,[t("label",{class:"label",for:B.item.name},[t("small",null,f(_.item.label),1)],8,ae),t("div",ie,[t("div",ce,[t("select",{name:_.item.name,id:_.item.name,style:{width:"100%"}},[y(d)===null&&!y(b)?(e(),l("option",ue," Data is loading... ")):a("",!0),y(b)?(e(),l("option",de," something error occured ")):a("",!0),y(b)?a("",!0):(e(),l("option",fe,f(_.item.firstOption),1)),y(b)?a("",!0):(e(!0),l(D,{key:3},j(y(d),w=>(e(),l("option",{value:w.id,selected:w.id===y(g).query[_.item.name]},f(w[_.item.labelField]),9,_e))),256))],8,re)])])]))}},ve={class:"columns is-multiline"},me={key:0,class:"field"},he=["for"],ye={class:"control"},be=["id","name","value","placeholder"],ke={key:1,class:"field"},ge=["for"],xe={class:"control"},$e={class:"select is-small",style:{width:"100%"}},we=["name","id"],Ce=["value","selected"],Le={__name:"Filter",props:{filter:Array,routeBack:{type:String,default:"/employee"},resetList:{type:Function,default:null}},setup(B){const g=B,_=T(),d=I();function b(){return g.filter.filter(i=>i.name==="text_search")[0].fields}function p(h,i){return i.filter(o=>o.name===h)[0]}async function x(h){h.preventDefault();const i=h.target,s=new FormData(i);let o=Object.fromEntries(s.entries());if(o=se(o),Object.keys(o).length===0)return;const v=[],C={};if(o.text_search!==void 0){const $=o.text_search;C.text_search=$,b().forEach(O=>{v.push(`${O}~'${$}'`)})}for(const[$,L]of Object.entries(o))$!="text_search"&&L!=""&&(C[$]=L,p($,g.filter).type==="select"?v.push(`${$}="${L}"`):v.push(`${$}?~"${L}"`));const V=v.join("||");C.filter=V,console.log(d.path),_.push({path:d.path,query:C})}function w(){_.push(d.path),g.resetList!==null&&g.resetList()}return(h,i)=>(e(),l("form",{novalidate:"",onSubmit:x},[t("div",ve,[(e(!0),l(D,null,j(g.filter,s=>(e(),l("div",{class:z(["column",g.filter.length===1?"is-6":"is-3"])},[s.type==="text_search"?(e(),l("div",me,[t("label",{class:"label",for:s.name},[t("small",null,f(s.label),1)],8,he),t("div",ye,[t("input",{id:s.name,class:"input is-small",name:s.name,value:y(d).query.text_search,type:"text",placeholder:s.placeholder},null,8,be)])])):a("",!0),s.type==="select"?(e(),l("div",ke,[t("label",{class:"label",for:s.name},[t("small",null,f(s.label),1)],8,ge),t("div",xe,[t("div",$e,[t("select",{name:s.name,id:s.name,style:{width:"100%"}},[(e(!0),l(D,null,j(s.options,o=>(e(),l("option",{value:o.value,selected:o.value===y(d).query[s.name]},f(o.label),9,Ce))),256))],8,we)])])])):a("",!0),s.type==="relational_field_select"?(e(),E(pe,{key:2,item:s},null,8,["item"])):a("",!0)],2))),256)),t("div",{class:"column is-12"},[t("div",{class:"field"},[t("div",{class:"control"},[i[0]||(i[0]=t("button",{class:"button is-dark is-small",type:"submit"},[t("i",{class:"bi bi-search pr-1"}),P(" Search ")],-1)),t("button",{class:"button is-secondary ml-2 is-small",onClick:w}," Reset ")])])])])],32))}},De={key:1},Be={class:"box"},Fe={key:0,class:"box"},Se={class:"is-flex"},je={class:"has-text-weight-bold"},Oe={key:1,class:"scroll-div"},Ee={class:"has-text-grey"},Ve={class:"table is-fullwidth is-striped"},qe=["checked","indeterminate"],Ie={key:0},Ae=["value"],Ne=["onClick"],Re={key:0},He={key:1},Me={key:2},Te={key:3},ze={key:0},Pe={key:6},Ye={key:2,class:"mt-4"},Ke={key:0,class:"has-text-weight-bold"},Qe={key:3,class:"has-text-danger"},Ue={__name:"ListDisplay",props:{listHeader:Array,collection:String,filter:Array,detailViewLink:String,routeBack:{type:String},expand:{type:String,default:""}},setup(B){const g=T(),_=I(),d=k(!0),b=k(null),p=k(null),x=k(1),w=k("-created"),h=k(""),i=k([]),s=k(!1),o=k([]),v=B;async function C(u,r="-created",m="",n=!1){n||(d.value=!0);try{const F=await q.collection(v.collection).getList(u,5,{filter:m,sort:r,expand:v.expand});p.value=F,n?o.value.push(...F.items):(o.value=F.items,d.value=!1)}catch{n||(o.value=[],p.value=null),d.value=!1}}M(()=>{L(_.query)}),J(()=>_.query,(u,r)=>{L(u)}),W(()=>{C(x.value,w.value,h.value,s.value)});function V(){C(x.value,w.value,h.value,s.value)}function $(){x.value<p.value.totalPages&&(x.value+=1,s.value=!0)}function L(u){u.filter!==void 0&&(h.value=u.filter,x.value=1,s.value=!1)}function O(){o.value=[],x.value=1,h.value="",s.value=!1}function A(u,r){let m=[];for(let n=0;n<r.length;n++)u[r[n]]!==""&&m.push(u[r[n]]);return m.join(" ")}function Y(u){const r=p.value.page,m=p.value.perPage;return(r-1)*m+(u+1)}function K(u){console.log("select all trigger"),u.target.checked?i.value=o.value:i.value=[]}async function Q(){if(!(await S.fire({title:"Are you sure want to delete?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#171717",cancelButtonColor:"#808080",confirmButtonText:"Yes, delete it!"})).isConfirmed||i.value.length===0)return;const r=q.createBatch();i.value.forEach((m,n)=>{r.collection(v.collection).delete(m.id)}),S.fire({title:"Data is deleting ...",allowOutsideClick:!1,didOpen:()=>{S.showLoading()}});try{await r.send(),C(x.value,w.value,h.value),i.value=[],S.close()}catch(m){console.log(m),S.close(),S.fire({title:"Error!",text:m.data.message,icon:"error"}),i.value=[]}}function U(u){g.push(`${v.detailViewLink}/${u.id}`)}return(u,r)=>{const m=X("tempalte");return e(),l(D,null,[d.value?(e(),E(le,{key:0})):a("",!0),!d.value&&p.value?(e(),l("div",De,[t("div",Be,[N(Le,{filter:v.filter,routeBack:v.routeBack,resetList:O},null,8,["filter","routeBack"])]),i.value.length>0?(e(),l("div",Fe,[t("div",Se,[t("p",je,f(i.value.length)+" selected out of "+f(o.value.length),1),t("button",{class:"button is-danger is-small ml-4",onClick:Q},r[1]||(r[1]=[t("i",{class:"bi bi-archive pr-1"},null,-1),P(" Delete ")]))])])):a("",!0),o.value.length>0?R((e(),l("div",Oe,[t("p",Ee,"Total Items: "+f(p.value.totalItems),1),t("table",Ve,[t("thead",null,[t("tr",null,[t("th",null,[t("input",{class:"custom-checkbox",onClick:K,type:"checkbox",checked:i.value.length===o.value.length,indeterminate:i.value.length>0&&i.value.length<o.value.length},null,8,qe)]),(e(!0),l(D,null,j(v.listHeader,n=>(e(),l(D,null,[n.can!==!1?(e(),l("th",Ie,f(n.label),1)):a("",!0)],64))),256))])]),t("tbody",null,[(e(!0),l(D,null,j(o.value,(n,F)=>(e(),l("tr",{key:n.id},[t("td",null,[R(t("input",{"onUpdate:modelValue":r[0]||(r[0]=c=>i.value=c),value:n,class:"custom-checkbox",type:"checkbox"},null,8,Ae),[[Z,i.value]])]),(e(!0),l(D,null,j(v.listHeader,c=>(e(),l("td",{class:z({"text-link":c.link}),onClick:Ge=>c.link&&U(n)},[c.type==="serial_number"?(e(),l("span",Re,f(Y(F)),1)):a("",!0),c.type==="text"?(e(),l("span",He,f(n[c.name]),1)):a("",!0),c.type==="combined"?(e(),l("span",Me,f(A(n,c.combinedField)),1)):a("",!0),c.type==="date"?(e(),l("span",Te,f(n[c.name].split(" ")[0]),1)):a("",!0),c.type==="expand"?(e(),E(m,{key:4},{default:H(()=>[c.isCombinedField?(e(),l("span",ze,f(A(n.expand[c.expandCollection],c.fields)),1)):a("",!0)]),_:2},1024)):a("",!0),c.type==="custom_component"&&c.can!==!1?(e(),E(ee(c.component),{key:5,item:n,header:c,reloadData:V},null,8,["item","header"])):a("",!0),c.type==="action"?(e(),l("span",Pe,[N(y(te),{class:"button is-dark",style:{width:"10px",height:"20px"},to:`${y(_).path}/edit/${n.id}`},{default:H(()=>r[2]||(r[2]=[t("i",{class:"bi bi-pencil",style:{"font-size":"10px"}},null,-1)])),_:2},1032,["to"])])):a("",!0)],10,Ne))),256))]))),128))])])])),[[y(oe),$]]):a("",!0)])):a("",!0),!d.value&&b.value===null?(e(),l("div",Ye,[o.value.length===0?(e(),l("p",Ke," no any data to show ")):a("",!0)])):a("",!0),b.value!==null?(e(),l("p",Qe,f(b.value),1)):a("",!0)],64)}}},lt=G(Ue,[["__scopeId","data-v-c48b4a9f"]]);export{lt as L};
