import{B as j,c as y}from"./BreadCrumb-TF3kDMJB.js";import{r as i,i as B,p as E,c as l,d as f,k as v,a as r,t as k,u as w,F as S,f as L,o as n,n as D,l as N,h as V}from"./index-C7IYLqTz.js";import{L as q}from"./LoadingSkeleton-DhLAkGpz.js";import{s as h,g as P}from"./utils-cUNVy0Hq.js";import{S as T}from"./sweetalert2.esm.all-DPo3DB14.js";import{R as z}from"./RenderForms-DFjF9nMb.js";import"./index.esm-CWnM2rkH.js";const K={key:0,class:"mt-4"},G={key:1},H={class:"card mt-3"},I={class:"card-content"},J={class:"has-text-weight-bold"},M={class:"columns is-multiline"},Q={key:2,class:"mt-4"},U={class:"has-text-danger"},se={__name:"Add",props:{parentRoute:String,label:String},setup($){const p=i(!1),c=i(null),d=i(null),t=N(),C=V(),b=i([]),_=i({}),u=$;B(()=>[t.params.id,t.params.query],R,{immediate:!0}),E(()=>{const a=[{label:"Dashboard",path:"/",isActive:!1},{label:u.label,path:`/${u.parentRoute}/collection/${t.params.id}`,isActive:!1},{label:h(t.params.id),path:`/${u.parentRoute}/collection/${t.params.id}`,isActive:!1},{label:"Add",path:`/settings/collection/${t.params.id}/add`,isActive:!0}];b.value=a});async function R(){c.value=d.value=null,p.value=!0;try{const a=await y.send(`/api/get_collection/${t.params.id}`);c.value=a.collection}catch{d.value="something bad occured"}finally{p.value=!1}}function x(a){let s=a.map(e=>(e.label=h(e.name),e.placeholder=e.name,e.type==="select"&&(e.options=e.values.map(o=>({label:o,value:o}))),e.type==="relation"&&(e.type="relational_field_select",e.collection=e.name,e.labelField="name",e.firstOption=`select ${e.name}`),console.log(e),e));return s=s.filter(e=>{if(e.name!=="tokenKey"&&e.type!=="autodate"&&e.name!=="id")return e}),t.params.id==="users"&&s.splice(1,0,{name:"passwordConfirm",label:"Password Confirm",type:"password",required:!0,placeholder:"password confirm"}),s}async function A(a){a.preventDefault();const s=a.target,e=new FormData(s);let o=Object.fromEntries(e.entries());o=P(o);try{const m=await y.collection(t.params.id).create(o);console.log(m),T.fire({title:"Success!",text:"successfully create",icon:"success"}),C.push(`/${u.parentRoute}/collection/${t.params.id}`)}catch(m){if(m.data.data){const g={};Object.entries(m.data.data).forEach(([F,O])=>{g[F]=O.message}),_.value=g}}}return(a,s)=>(n(),l(S,null,[f(j,{links:b.value},null,8,["links"]),p.value?(n(),l("div",K,[f(q)])):v("",!0),c.value!==null?(n(),l("div",G,[r("div",H,[r("div",I,[r("form",{novalidate:"",onSubmit:A},[r("legend",J," Add "+k(w(h)(w(t).params.id)),1),s[0]||(s[0]=r("div",{class:"is-flex is-flex-direction-row-reverse"},[r("button",{class:"button is-dark",type:"submit"}," Save ")],-1)),r("div",M,[(n(!0),l(S,null,L(x(c.value.fields),e=>(n(),l("div",{class:D(["column",e.type==="editor"?"is-12":"is-4"])},[f(z,{form:e,errors:_.value},null,8,["form","errors"])],2))),256))])],32)])])])):v("",!0),d.value!==null?(n(),l("div",Q,[r("p",U,k(d.value),1)])):v("",!0)],64))}};export{se as default};
