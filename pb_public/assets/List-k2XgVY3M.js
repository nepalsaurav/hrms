import{c as S,B as j}from"./BreadCrumb-TF3kDMJB.js";import{_ as P,r,b as Q,i as N,p as T,o as e,c as t,d as b,k as v,a,t as p,e as V,g as I,u as h,F as k,f as B,q as H,n as J,l as F,h as K,w as W,R as X}from"./index-C7IYLqTz.js";import{L as M}from"./LoadingSkeleton-DhLAkGpz.js";import{s as D,c as Z}from"./utils-cUNVy0Hq.js";import{v as ee}from"./index-Cfw59jWj.js";import{S as x}from"./sweetalert2.esm.all-DPo3DB14.js";import{_ as te}from"./Avatar-BQIjk-Wl.js";import"./index.esm-CWnM2rkH.js";const ae={key:0},le={key:1},se={key:0,class:"box"},ne={class:"is-flex"},oe={class:"has-text-weight-bold"},ie={key:1,class:"scroll-div"},ce={class:"has-text-grey"},re={class:"table is-fullwidth is-striped"},ue=["checked","indeterminate"],de={key:0},pe=["value"],ve=["onClick"],me={key:0},fe={key:1},he={key:2},_e={key:3},ye={key:4},ke={key:2,class:"mt-3 has-text-weight-bold"},xe={key:2},be={class:"has-text-danger"},ge={__name:"GenericList",props:{schema:Object,expand:{type:String,default:""},expandLabel:{type:String,default:""}},setup(C){const u=C,_=r(!0),d=r(null),o=r(null),n=r([]),y=F(),L=K(),f=r(!1),m=r([]),g=r(1),R=r(""),O=r("-created");async function A(i=1,c="-created",l="",s=!1){o.value=null,s||(_.value=!0);try{const w=u.schema.name,$=await S.collection(w).getList(i,50,{sort:c,filter:l,expand:u.expand});d.value=$,s?m.value.push(...$.items):m.value=$.items}catch(w){o.value=w.data.message}finally{s||(_.value=!1)}}function z(){g.value<d.value.totalPages&&(g.value+=1,f.value=!0)}Q(()=>{E(y.query)}),N(()=>y.query,(i,c)=>{E(i)},{immediate:!0}),T(()=>{A(g.value,O.value,R.value,f.value)});function E(i){i.filter!==void 0&&(R.value=i.filter,g.value=1,f.value=!1)}function q(i){const c=["id","created","updated"];return!i.hidden&&!c.includes(i.name)}function G(i){i.target.checked?n.value=m.value:n.value=[]}async function U(){if(!(await x.fire({title:"Are you sure want to delete?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#171717",cancelButtonColor:"#808080",confirmButtonText:"Yes, delete it!"})).isConfirmed||n.value.length===0)return;const c=S.createBatch();n.value.forEach((l,s)=>{c.collection(u.schema.name).delete(l.id)}),x.fire({title:"Data is deleting ...",allowOutsideClick:!1,didOpen:()=>{x.showLoading()}});try{await c.send(),A(),n.value=[],x.close()}catch(l){x.close(),x.fire({title:"Error!",text:l.data.message,icon:"error"}),n.value=[]}}function Y(i){L.push(`${y.path}/edit/${i.id}`)}return(i,c)=>(e(),t(k,null,[_.value&&d.value===null?(e(),t("div",ae,[b(M)])):v("",!0),d.value!==null?(e(),t("div",le,[n.value.length>0?(e(),t("div",se,[a("div",ne,[a("p",oe,p(n.value.length)+" selected out of "+p(m.value.length),1),a("button",{class:"button is-danger is-small ml-4",onClick:U},c[1]||(c[1]=[a("i",{class:"bi bi-archive pr-1"},null,-1),V(" Delete ")]))])])):v("",!0),d.value.items.length>0?I((e(),t("div",ie,[a("p",ce,"Total Items: "+p(d.value.totalItems),1),a("table",re,[a("thead",null,[a("tr",null,[a("th",null,[a("input",{class:"custom-checkbox",onClick:G,type:"checkbox",checked:n.value.length===m.value.length,indeterminate:n.value.length>0&&n.value.length<m.value.length},null,8,ue)]),(e(!0),t(k,null,B(u.schema.fields,l=>(e(),t(k,{key:l.name},[q(l)?(e(),t("th",de,p(h(D)(l.name)),1)):v("",!0)],64))),128))])]),a("tbody",null,[(e(!0),t(k,null,B(m.value,l=>(e(),t("tr",null,[a("td",null,[I(a("input",{"onUpdate:modelValue":c[0]||(c[0]=s=>n.value=s),value:l,class:"custom-checkbox",type:"checkbox"},null,8,pe),[[H,n.value]])]),(e(!0),t(k,null,B(u.schema.fields,(s,w)=>(e(),t(k,null,[q(s)?(e(),t("td",{key:0,onClick:$=>Y(l),class:"edit-data"},[s.type==="autodate"?(e(),t("span",me,p(h(Z)(l[s.name])),1)):s.type==="bool"?(e(),t("span",fe,[a("span",{class:J(["tag",l[s.name]===!0?"is-info":"is-danger"])},p(l[s.name]),3)])):s.type==="relation"&&u.expand!==""&&u.expandLabel!=""?(e(),t("span",he,p(l.expand[s.name][u.expandLabel]),1)):s.name==="avatar"?(e(),t("span",_e,[b(te,{filename:l[s.name],record:l,size:"64x64"},null,8,["filename","record"])])):(e(),t("span",ye,p(l[s.name]),1))],8,ve)):v("",!0)],64))),256))]))),256))])])])),[[h(ee),z]]):v("",!0),d.value.items.length===0?(e(),t("p",ke," no any data to show ")):v("",!0)])):v("",!0),o.value!==null?(e(),t("div",xe,[a("p",be,p(o.value),1)])):v("",!0)],64))}},we=P(ge,[["__scopeId","data-v-dd0101c9"]]),$e={key:0,class:"mt-4"},Ce={key:1},Le={class:"is-flex is-flex-direction-row-reverse"},Be={class:"card mt-3"},Se={class:"card-content"},De={key:2,class:"mt-4"},Re={class:"has-text-danger"},Me={__name:"List",props:{parentRoute:String,label:String},setup(C){const u=r(!1),_=r(null),d=r(null),o=F(),n=r([]),y=C;T(()=>{const f=[{label:"Dashboard",path:"/",isActive:!1},{label:y.label,path:`/${y.parentRoute}/collection/${o.params.id}`,isActive:!1},{label:D(o.params.id),path:`/${y.parentRoute}/collection/${o.params.id}`,isActive:!0}];n.value=f}),N(()=>[o.params.id,o.query],L,{immediate:!0});async function L(){_.value=d.value=null,u.value=!0;try{const f=await S.send(`/api/get_collection/${o.params.id}`);_.value=f.collection}catch{d.value="something bad occured"}finally{u.value=!1}}return(f,m)=>(e(),t(k,null,[b(j,{links:n.value},null,8,["links"]),u.value?(e(),t("div",$e,[b(M)])):v("",!0),_.value!==null?(e(),t("div",Ce,[a("div",Le,[b(h(X),{to:`/${y.parentRoute}/collection/${h(o).params.id}/add`,class:"button is-dark"},{default:W(()=>[m[0]||(m[0]=a("i",{class:"bi bi-plus-circle px-1"},null,-1)),V(" Add "+p(h(D)(h(o).params.id)),1)]),_:1},8,["to"])]),a("div",Be,[a("div",Se,[b(we,{schema:_.value,expand:h(o).query.expand,expandLabel:h(o).query.expand_label},null,8,["schema","expand","expandLabel"])])])])):v("",!0),d.value!==null?(e(),t("div",De,[a("p",Re,p(d.value),1)])):v("",!0)],64))}};export{Me as default};
