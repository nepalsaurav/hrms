import{_ as H,r,x as J,m as A,o as e,c as t,b as k,L as O,d as v,a as l,t as m,e as j,h as z,u as h,F as g,f as R,y as W,n as X,z as Z,q as G,k as ee,g as F,A as te,w as ae,R as se}from"./index-DhUzF4e6.js";import{s as T,c as le}from"./utils-RVpx9FsL.js";import{v as ne,_ as oe}from"./index-Dh1WwN9N.js";import{_ as ie}from"./Status-SrFYIGJX.js";import{S as x}from"./sweetalert2.esm.all-CIewtpap.js";import{B as ce}from"./BreadCrumb-QusY3eB5.js";import"./index.esm-DyswK6GF.js";import"./forms-Lc3CRwVw.js";const re={key:0},ue={key:1},de={key:0,class:"box"},me={class:"is-flex"},pe={class:"has-text-weight-bold"},ve={key:1,class:"scroll-div"},fe={class:"has-text-grey"},_e={class:"table is-fullwidth is-striped"},he=["checked","indeterminate"],ye=["value"],ke=["onClick"],ge={key:0},be={key:1},xe={key:2},we={key:3},$e={key:4},Ce={key:5},Le={key:6},Se={key:2,class:"mt-3 has-text-weight-bold"},Be={key:2},De={class:"has-text-danger"},Re={__name:"GenericList",props:{schema:Object,expand:{type:String,default:""},expandLabel:{type:String,default:""}},setup(w){const _=w,f=r(!0),n=r(null),u=r(null),o=r([]),y=G(),$=ee(),C=r(!1),c=r([]),d=r(1),S=r(""),E=r("-created"),U={employee:"full_name",company:"name"},{name:I,fields:B}=_.schema;async function N(i=1,p="-created",s="",a=!1){u.value=null,a||(f.value=!0);try{const b=B.filter(D=>D.type==="relation").map(D=>D.name).join(","),L=await F.collection(I).getList(i,50,{sort:p,filter:s,expand:b});n.value=L,c.value=a?[...c.value,...L.items]:L.items}catch(b){u.value=b.data.message}finally{a||(f.value=!1)}}function Y(){d.value<n.value.totalPages&&(d.value+=1,C.value=!0)}J(()=>V(y.query)),A(()=>y.query,i=>V(i),{immediate:!0}),A(()=>[d.value,E.value,S.value],()=>N(d.value,E.value,S.value,C.value),{immediate:!0});function V(i){i.filter!==void 0&&(S.value=i.filter,d.value=1,C.value=!1)}function q(i){const p=["id","created","updated","address"];return!i.hidden&&!p.includes(i.name)}function K(i){o.value=i.target.checked?[...c.value]:[]}async function P(){if(!(await x.fire({title:"Are you sure want to delete?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#171717",cancelButtonColor:"#808080",confirmButtonText:"Yes, delete it!"})).isConfirmed||o.value.length===0)return;const p=F.createBatch();o.value.forEach(s=>p.collection(I).delete(s.id)),x.fire({title:"Data is deleting ...",allowOutsideClick:!1,didOpen:()=>x.showLoading()});try{await p.send(),N(),o.value=[],x.close()}catch(s){x.close(),x.fire({title:"Error!",text:s.data.message,icon:"error"}),o.value=[]}}function Q(i){$.push(`${y.path}/edit/${i.id}`)}return(i,p)=>(e(),t(g,null,[f.value&&!n.value?(e(),t("div",re,[k(O)])):v("",!0),n.value?(e(),t("div",ue,[o.value.length>0?(e(),t("div",de,[l("div",me,[l("p",pe,m(o.value.length)+" selected out of "+m(c.value.length),1),l("button",{class:"button is-danger is-small ml-4",onClick:P},p[1]||(p[1]=[l("i",{class:"bi bi-archive pr-1"},null,-1),j(" Delete ")]))])])):v("",!0),n.value.items.length>0?z((e(),t("div",ve,[l("p",fe,"Total Items: "+m(n.value.totalItems),1),l("table",_e,[l("thead",null,[l("tr",null,[l("th",null,[l("input",{class:"custom-checkbox",type:"checkbox",onClick:K,checked:o.value.length===c.value.length,indeterminate:o.value.length>0&&o.value.length<c.value.length},null,8,he)]),(e(!0),t(g,null,R(h(B),s=>(e(),t(g,null,[q(s)?(e(),t("th",{key:s.name},m(h(T)(s.name)),1)):v("",!0)],64))),256))])]),l("tbody",null,[(e(!0),t(g,null,R(c.value,s=>(e(),t("tr",{key:s.id},[l("td",null,[z(l("input",{"onUpdate:modelValue":p[0]||(p[0]=a=>o.value=a),value:s,class:"custom-checkbox",type:"checkbox"},null,8,ye),[[W,o.value]])]),(e(!0),t(g,null,R(h(B),a=>{var b;return e(),t(g,null,[q(a)?(e(),t("td",{onClick:L=>Q(s),class:"edit-data",key:a.name},[a.type==="autodate"?(e(),t("span",ge,m(h(le)(s[a.name])),1)):a.type==="bool"?(e(),t("span",be,[l("span",{class:X(["tag",s[a.name]?"is-info":"is-danger"])},m(s[a.name]),3)])):a.type==="relation"?(e(),t("span",xe,m((b=s.expand[a.name])==null?void 0:b[U[a.name]]),1)):["avatar","logo"].includes(a.name)?(e(),t("span",we,[k(Z,{filename:s[a.name],record:s,size:"64x64"},null,8,["filename","record"])])):a.type==="date"?(e(),t("span",$e,m(s[a.name].split(" ")[0]),1)):a.name==="status"?(e(),t("span",Ce,[k(ie,{item:s,header:a},null,8,["item","header"])])):(e(),t("span",Le,m(s[a.name]),1))],8,ke)):v("",!0)],64)}),256))]))),128))])])])),[[h(ne),Y]]):v("",!0),n.value.items.length===0?(e(),t("p",Se,"No data to show")):v("",!0)])):v("",!0),u.value?(e(),t("div",Be,[l("p",De,m(u.value),1)])):v("",!0)],64))}},Ae=H(Re,[["__scopeId","data-v-4f41c180"]]),M={employee:["employee.first_name","employee.last_name","employee.middle_name"]};function Fe(w){const _=[],f=["id","created","updated","password","tokenKey"];return w.fields.forEach(n=>{f.includes(n.name)||(n.type==="relation"?M[n.name]!==void 0&&_.push(...M[n.name]):_.push(n.name))}),_}const Te={key:0,class:"mt-4"},Ee={key:1},Ie={class:"is-flex is-flex-direction-row-reverse"},Ne={class:"card mt-3"},Ve={class:"card-content"},qe={class:"mb-4"},ze={key:2,class:"mt-4"},Me={class:"has-text-danger"},He={__name:"List",props:{parentRoute:String,label:String},setup(w){const _=r(!1),f=r(null),n=r(null),u=G(),o=r([]),y=w,$=r([]);te(()=>{const c=[{label:"Dashboard",path:"/",isActive:!1},{label:y.label,path:`/${y.parentRoute}/collection/${u.params.id}`,isActive:!1},{label:T(u.params.id),path:`/${y.parentRoute}/collection/${u.params.id}`,isActive:!0}];o.value=c}),A(()=>[u.params.id,u.query],C,{immediate:!0});async function C(){f.value=n.value=null,_.value=!0;try{const c=await F.send(`/api/get_collection/${u.params.id}`),d=Fe(c.collection);console.log(d),$.value=[{name:"text_search",label:"Search",type:"text_search",fields:d,placeholder:"search"}],$.value.fields=d,f.value=c.collection}catch{n.value="something bad occured"}finally{_.value=!1}}return(c,d)=>(e(),t(g,null,[k(ce,{links:o.value},null,8,["links"]),_.value?(e(),t("div",Te,[k(O)])):v("",!0),f.value!==null?(e(),t("div",Ee,[l("div",Ie,[k(h(se),{to:`/${y.parentRoute}/collection/${h(u).params.id}/add`,class:"button is-dark"},{default:ae(()=>[d[0]||(d[0]=l("i",{class:"bi bi-plus-circle px-1"},null,-1)),j(" Add "+m(h(T)(h(u).params.id)),1)]),_:1},8,["to"])]),l("div",Ne,[l("div",Ve,[l("div",qe,[k(oe,{filter:$.value},null,8,["filter"])]),k(Ae,{schema:f.value},null,8,["schema"])])])])):v("",!0),n.value!==null?(e(),t("div",ze,[l("p",Me,m(n.value),1)])):v("",!0)],64))}};export{He as default};
