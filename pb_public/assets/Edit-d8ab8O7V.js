import{B as V,c as v}from"./BreadCrumb-TF3kDMJB.js";import{r as n,i as B,p as L,c as i,d as h,k as b,a as l,t as w,u as S,F as E,f as A,o as c,n as N,l as I,h as P}from"./index-C7IYLqTz.js";import{L as q}from"./LoadingSkeleton-DhLAkGpz.js";import{s as _,t as z}from"./utils-cUNVy0Hq.js";import{S as K}from"./sweetalert2.esm.all-DPo3DB14.js";import{R as T}from"./RenderForms-DFjF9nMb.js";import"./index.esm-CWnM2rkH.js";const G={key:0,class:"mt-4"},H={key:1},J={class:"card mt-3"},M={class:"card-content"},Q={class:"has-text-weight-bold"},U={class:"columns is-multiline"},W={key:2,class:"mt-4"},X={class:"has-text-danger"},oe={__name:"Edit",props:{parentRoute:String,label:String},setup($){const u=$,f=n(!1),d=n(null),m=n(null),a=I(),C=P(),g=n([]),y=n({}),r=n(null);B(()=>[a.params.id,a.params.query],D,{immediate:!0}),L(()=>{const t=[{label:"Dashboard",path:"/",isActive:!1},{label:u.label,path:`/${u.parentRoute}/collection/${a.params.id}`,isActive:!1},{label:_(a.params.id),path:`/${u.parentRoute}/collection/${a.params.id}`,isActive:!1},{label:"Edit",path:`/settings/collection/${a.params.id}/add`,isActive:!0}];g.value=t});async function D(){d.value=m.value=null,f.value=!0;try{const t=await v.send(`/api/get_collection/${a.params.id}`);d.value=t.collection;const s=await v.collection(a.params.id).getOne(a.params.collectionID);r.value=s}catch{m.value="something bad occured"}finally{f.value=!1}}function O(t){let s=t.map(e=>(e.label=_(e.name),e.placeholder=e.name,e.type==="select"&&(e.options=e.values.map(o=>({label:o,value:o}))),e.type==="relation"&&(e.type="relational_field_select",e.collection=e.name,e.labelField="name",e.firstOption=`select ${e.name}`),e));return s=s.filter(e=>{if(e.name!=="tokenKey"&&e.type!=="autodate"&&e.name!=="id")return e}),a.params.id==="users"&&s.splice(1,0,{name:"passwordConfirm",label:"Password Confirm",type:"password",placeholder:"password confirm"}),s}async function R(t){t.preventDefault();const s=t.target,e=new FormData(s);let o=Object.fromEntries(e.entries());o=z(o),console.log(Object.fromEntries(o.entries()));try{const p=await v.collection(a.params.id).update(a.params.collectionID,o);console.log(p),K.fire({title:"Success!",text:"successfully updated",icon:"success"}),C.push(`/${u.parentRoute}/collection/${a.params.id}`)}catch(p){if(p.data.data){const k={};Object.entries(p.data.data).forEach(([F,j])=>{k[F]=j.message}),y.value=k}}}function x(t){return console.log(t.name,r.value),r.value&&r.value[t.name]!==void 0?r.value[t.name]:""}return(t,s)=>(c(),i(E,null,[h(V,{links:g.value},null,8,["links"]),f.value?(c(),i("div",G,[h(q)])):b("",!0),d.value!==null&&r.value!=null?(c(),i("div",H,[l("div",J,[l("div",M,[l("form",{novalidate:"",onSubmit:R},[l("legend",Q," Edit "+w(S(_)(S(a).params.id)),1),s[0]||(s[0]=l("div",{class:"is-flex is-flex-direction-row-reverse"},[l("button",{class:"button is-dark",type:"submit"}," Save ")],-1)),l("div",U,[(c(!0),i(E,null,A(O(d.value.fields),e=>(c(),i("div",{class:N(["column",e.type==="editor"?"is-12":"is-4"])},[h(T,{form:e,errors:y.value,defaultValue:x(e)},null,8,["form","errors","defaultValue"])],2))),256))])],32)])])])):b("",!0),m.value!==null?(c(),i("div",W,[l("p",X,w(m.value),1)])):b("",!0)],64))}};export{oe as default};
