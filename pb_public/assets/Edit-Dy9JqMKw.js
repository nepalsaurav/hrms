import{r as c,i as $,b as z,c as i,d as T,a as t,y as b,t as y,k as g,F as x,f as B,o as d,g as k,z as w,h as G,l as H}from"./index-C7IYLqTz.js";import{c as S,B as I}from"./BreadCrumb-TF3kDMJB.js";import{S as M}from"./sweetalert2.esm.all-DPo3DB14.js";import{e as J}from"./impureFunctionsAny.generated-Bx06YqVH.js";const K={class:"card"},Q={class:"card-content"},W=["disabled"],X={class:"columns is-multiline"},Y={class:"column is-12"},Z=["value"],ee={key:0,class:"has-text-danger mt-2"},ae={class:"column is-12"},te={class:"column"},le=["onUpdate:modelValue"],oe={key:0,id:"name_options"},se=["value"],ne={class:"column"},re=["onUpdate:modelValue"],ue={class:"column"},ce=["onUpdate:modelValue"],ie={class:"column is-narrow"},de=["onClick"],me={key:0,class:"has-text-danger mt-2"},ve={class:"is-flex is-flex-direction-row-reverse"},ye={__name:"Edit",setup(fe){const n=c([]),f=c([]),h=c(null),v=c([]),r=c({}),R=c([]),m=c({}),_=c(!1),D=G(),p=H();$(()=>[p.params.id,p.params.query],F,{immediate:!0});async function F(){try{const a=await S.collection("salary_structure").getOne(p.params.id);h.value=a,a.components.forEach(e=>{n.value.push({name:e.name,amount:e.amount,calculated:e.calculated}),e.calculated!==""?r.value[e.component[0].abbreviation]=e.calculated:r.value[e.component[0].abbreviation]=e.amount})}catch{}}z(async()=>{try{const a=await S.collection("salary_component").getFullList({});v.value=a,f.value=a,R.value=f.map(e=>e.abbreviation)}catch{}});function A(a){return f.value.length>0?f.value.filter(l=>l.name===a):[]}function N(){n.value.forEach(a=>{if(a.name!==""){const e=v.value.filter(l=>l.name!==a.name);v.value=e}}),n.value.forEach(a=>{if(a.name!==""){console.log(a.name);const e=A(a.name);e.length>0&&(a.amount!==0&&(r.value[e[0].abbreviation]=a.amount),a.calculated!==""&&(r.value[e[0].abbreviation]=a.calculated),console.log(r.value))}}),n.value.push({name:"",amount:void 0,calculated:""})}function O(a){n.value.length>1&&n.value.splice(a,1)}function V(a,e){try{const l=J(a,e);return l.fixPrefix!==void 0?[l.fixPrefix,null]:[!0,l]}catch{return[!1,null]}}function L(a){const e=a.target;console.log(e.value);const[l,u]=V(e.value,r.value);console.log(l,u,"expressiomn")}function P(a){const e=a.target,l=new FormData(e);let u=Object.fromEntries(l.entries());console.log(u),u.name===""&&(m.value.name="required field");const s=[];let C=!1,E="";if(n.value.forEach(o=>{if(o.calculated!==""){const[q,U]=V(o.calculated,r.value);if(console.log(q,U,o.calculated,r.value),!q){C=!0,E=o.name;return}o.finalAmount=U}else o.finalAmount=o.amount;o.component=A(o.name),s.push(o)}),C){M.fire({title:"Error!",text:`calculated formula error at ${E}`,icon:"error"});return}s.length===0&&(m.value.components="required field");const j=s.map(o=>(o.amount===void 0&&(o.amount=0),o));_.value=!0;try{const o=S.collection("salary_structure").update(p.params.id,{name:u.name,components:j});console.log(o),M.fire({title:"Success!",text:"successfully created",icon:"success"}),D.push("/payroll/salary_structure")}catch(o){console.log(o)}finally{_.value=!1}}return(a,e)=>(d(),i(x,null,[T(I,{links:[{label:"Dashboard",path:"/",isActive:!1},{label:"Payroll",path:"/payroll",isActive:!0},{label:"Salary Structure",path:"/payroll/salary_structure",isActive:!1},{label:"Add",path:"/payroll/salary_structure/add",isActive:!0}]}),t("div",K,[t("div",Q,[t("form",{novalidate:"",onSubmit:b(P,["prevent"])},[t("fieldset",{disabled:_.value},[e[2]||(e[2]=t("legend",{class:"has-text-weight-bold"}," Add Salary Structure ",-1)),e[3]||(e[3]=t("div",{class:"is-flex is-flex-direction-row-reverse"},[t("button",{class:"button is-dark",type:"submit"}," Save ")],-1)),t("div",X,[t("div",Y,[e[0]||(e[0]=t("label",{for:"name",class:"label"},"Name*",-1)),t("input",{type:"text",class:"input",id:"name",name:"name",value:h.value&&h.value.name,required:""},null,8,Z),m.value.name!==void 0?(d(),i("p",ee,y(m.value.name),1)):g("",!0)]),t("div",ae,[e[1]||(e[1]=t("label",{class:"label"},"Components*",-1)),(d(!0),i(x,null,B(n.value,(l,u)=>(d(),i("div",{key:u,class:"columns"},[t("div",te,[k(t("input",{type:"text",class:"input","onUpdate:modelValue":s=>l.name=s,placeholder:"Salary component",list:"name_options",required:""},null,8,le),[[w,l.name]]),v.value.length>0?(d(),i("datalist",oe,[(d(!0),i(x,null,B(v.value,s=>(d(),i("option",{value:s.name},y(s.name),9,se))),256))])):g("",!0)]),t("div",ne,[k(t("input",{type:"number",class:"input","onUpdate:modelValue":s=>l.amount=s,placeholder:"Amount",required:""},null,8,re),[[w,l.amount]])]),t("div",ue,[k(t("textarea",{class:"textarea has-text-success",onChange:L,"onUpdate:modelValue":s=>l.calculated=s,placeholder:"formula for calculated amount",required:""},null,40,ce),[[w,l.calculated]])]),t("div",ie,[t("button",{class:"button is-danger is-small mt-1",onClick:b(s=>O(u),["prevent"])}," Remove ",8,de)]),m.value.components!==void 0?(d(),i("p",me,y(m.value.components),1)):g("",!0)]))),128)),t("div",ve,[t("button",{class:"button is-dark is-small",onClick:b(N,["prevent"])}," Add ")])])])],8,W)],32)])])],64))}};export{ye as default};
