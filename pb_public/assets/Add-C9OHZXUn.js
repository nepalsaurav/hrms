import{r as i,m as O,A as B,c as o,b as f,d as v,a as r,t as g,u as k,F as w,f as E,g as S,o as n,L,n as D,j as q,q as N,k as V}from"./index-DhUzF4e6.js";import{s as b,g as P}from"./utils-RVpx9FsL.js";import{S as T}from"./sweetalert2.esm.all-CIewtpap.js";import{B as z}from"./BreadCrumb-QusY3eB5.js";import"./index.esm-DyswK6GF.js";const K={key:0,class:"mt-4"},G={key:1},H={class:"card mt-3"},I={class:"card-content"},J={class:"has-text-weight-bold"},M={class:"columns is-multiline"},Q={key:2,class:"mt-4"},U={class:"has-text-danger"},te={__name:"Add",props:{parentRoute:String,label:String},setup(F){const p=i(!1),c=i(null),d=i(null),t=N(),C=V(),h=i([]),_=i({}),u=F;O(()=>[t.params.id,t.params.query],$,{immediate:!0}),B(()=>{const a=[{label:"Dashboard",path:"/",isActive:!1},{label:u.label,path:`/${u.parentRoute}/collection/${t.params.id}`,isActive:!1},{label:b(t.params.id),path:`/${u.parentRoute}/collection/${t.params.id}`,isActive:!1},{label:"Add",path:`/settings/collection/${t.params.id}/add`,isActive:!0}];h.value=a});async function $(){c.value=d.value=null,p.value=!0;try{const a=await S.send(`/api/get_collection/${t.params.id}`);c.value=a.collection}catch{d.value="something bad occured"}finally{p.value=!1}}function A(a){let s=a.map(e=>(e.label=b(e.name),e.placeholder=e.name,e.type==="select"&&(e.options=e.values.map(l=>({label:l,value:l}))),e.type==="relation"&&(e.type="relational_field_select",e.collection=e.name,e.collection==="employee"?(e.isCombinedField=!0,e.combinedFields=["first_name","middle_name","last_name"],e.labelField="first_name"):e.labelField="name",e.firstOption=`select ${e.name}`),e));return s=s.filter(e=>{if(e.name!=="tokenKey"&&e.type!=="autodate"&&e.name!=="id")return e}),t.params.id==="users"&&s.splice(1,0,{name:"passwordConfirm",label:"Password Confirm",type:"password",required:!0,placeholder:"password confirm"}),s}async function x(a){a.preventDefault();const s=a.target,e=new FormData(s);let l=Object.fromEntries(e.entries());l=P(l);try{const m=await S.collection(t.params.id).create(l);console.log(m),T.fire({title:"Success!",text:"successfully create",icon:"success"}),C.push(`/${u.parentRoute}/collection/${t.params.id}`)}catch(m){if(m.data.data){const y={};Object.entries(m.data.data).forEach(([R,j])=>{y[R]=j.message}),_.value=y}}}return(a,s)=>(n(),o(w,null,[f(z,{links:h.value},null,8,["links"]),p.value?(n(),o("div",K,[f(L)])):v("",!0),c.value!==null?(n(),o("div",G,[r("div",H,[r("div",I,[r("form",{novalidate:"",onSubmit:x},[r("legend",J," Add "+g(k(b)(k(t).params.id)),1),s[0]||(s[0]=r("div",{class:"is-flex is-flex-direction-row-reverse"},[r("button",{class:"button is-dark",type:"submit"}," Save ")],-1)),r("div",M,[(n(!0),o(w,null,E(A(c.value.fields),e=>(n(),o("div",{class:D(["column",e.type==="editor"?"is-12":"is-4"])},[f(q,{form:e,errors:_.value},null,8,["form","errors"])],2))),256))])],32)])])])):v("",!0),d.value!==null?(n(),o("div",Q,[r("p",U,g(d.value),1)])):v("",!0)],64))}};export{te as default};
