import{r as c,b as O,c as u,d as P,a,y as h,t as _,k as b,F as y,f as w,o as i,g,z as x,h as j}from"./index-C7IYLqTz.js";import{c as C,B as $}from"./BreadCrumb-TF3kDMJB.js";import{S as E}from"./sweetalert2.esm.all-DPo3DB14.js";import{e as z}from"./impureFunctionsAny.generated-Bx06YqVH.js";const T={class:"card"},G={class:"card-content"},H=["disabled"],I={class:"columns is-multiline"},J={class:"column is-12"},K={key:0,class:"has-text-danger mt-2"},Q={class:"column is-12"},W={class:"column"},X=["onUpdate:modelValue"],Y={key:0,id:"name_options"},Z=["value"],ee={class:"column"},te=["onUpdate:modelValue"],ae={class:"column"},le=["onUpdate:modelValue"],se={class:"column is-narrow"},oe=["onClick"],ne={key:0,class:"has-text-danger mt-2"},re={class:"is-flex is-flex-direction-row-reverse"},ve={__name:"Add",setup(ue){const n=c([{name:"",amount:void 0,calculated:""}]),f=c([]),m=c([]),v=c({}),q=c([]),d=c({}),p=c(!1),U=j();O(async()=>{try{const t=await C.collection("salary_component").getFullList({});m.value=t,f.value=t,q.value=f.map(e=>e.abbreviation)}catch{}});function k(t){return f.value.length>0?f.value.filter(l=>l.name===t):[]}function B(){n.value.forEach(t=>{if(t.name!==""){const e=m.value.filter(l=>l.name!==t.name);m.value=e}}),n.value.forEach(t=>{if(t.name!==""){console.log(t.name);const e=k(t.name);e.length>0&&(t.amount!==0&&(v.value[e[0].abbreviation]=t.amount),t.calculated!==""&&(v.value[e[0].abbreviation]=t.calculated),console.log(v.value))}}),n.value.push({name:"",amount:void 0,calculated:""})}function M(t){n.value.length>1&&n.value.splice(t,1)}function A(t,e){try{const l=z(t,e);return l.fixPrefix!==void 0?l.fixPrefix:[!0,l]}catch{return[!1,null]}}function D(t){const e=t.target;console.log(e.value);const[l,r]=A(e.value,v.value);console.log(l,r,"expressiomn")}function F(t){const e=t.target,l=new FormData(e);let r=Object.fromEntries(l.entries());console.log(r),r.name===""&&(d.value.name="required field"),console.log(n.value);const o=[];let S=!1,V="";if(n.value.forEach(s=>{if(s.calculated!==""){const[R,L]=A(s.calculated,v.value);if(!R){S=!0,V=s.name;return}s.finalAmount=L}else s.finalAmount=s.amount;s.component=k(s.name),o.push(s)}),S){E.fire({title:"Error!",text:`calculated formula error at ${V}`,icon:"error"});return}o.length===0&&(d.value.components="required field");const N=o.map(s=>(s.amount===void 0&&(s.amount=0),s));p.value=!0;try{const s=C.collection("salary_structure").create({name:r.name,components:N});console.log(s),E.fire({title:"Success!",text:"successfully created",icon:"success"}),U.push("/payroll/salary_structure")}catch(s){console.log(s)}finally{p.value=!1}}return(t,e)=>(i(),u(y,null,[P($,{links:[{label:"Dashboard",path:"/",isActive:!1},{label:"Payroll",path:"/payroll",isActive:!0},{label:"Salary Structure",path:"/payroll/salary_structure",isActive:!1},{label:"Add",path:"/payroll/salary_structure/add",isActive:!0}]}),a("div",T,[a("div",G,[a("form",{novalidate:"",onSubmit:h(F,["prevent"])},[a("fieldset",{disabled:p.value},[e[3]||(e[3]=a("legend",{class:"has-text-weight-bold"}," Add Salary Structure ",-1)),e[4]||(e[4]=a("div",{class:"is-flex is-flex-direction-row-reverse"},[a("button",{class:"button is-dark",type:"submit"}," Save ")],-1)),a("div",I,[a("div",J,[e[0]||(e[0]=a("label",{for:"name",class:"label"},"Name*",-1)),e[1]||(e[1]=a("input",{type:"text",class:"input",id:"name",name:"name",required:""},null,-1)),d.value.name!==void 0?(i(),u("p",K,_(d.value.name),1)):b("",!0)]),a("div",Q,[e[2]||(e[2]=a("label",{class:"label"},"Components*",-1)),(i(!0),u(y,null,w(n.value,(l,r)=>(i(),u("div",{key:r,class:"columns"},[a("div",W,[g(a("input",{type:"text",class:"input","onUpdate:modelValue":o=>l.name=o,placeholder:"Salary component",list:"name_options",required:""},null,8,X),[[x,l.name]]),m.value.length>0?(i(),u("datalist",Y,[(i(!0),u(y,null,w(m.value,o=>(i(),u("option",{value:o.name},_(o.name),9,Z))),256))])):b("",!0)]),a("div",ee,[g(a("input",{type:"number",class:"input","onUpdate:modelValue":o=>l.amount=o,placeholder:"Amount",required:""},null,8,te),[[x,l.amount]])]),a("div",ae,[g(a("textarea",{class:"textarea has-text-success",onChange:D,"onUpdate:modelValue":o=>l.calculated=o,placeholder:"formula for calculated amount",required:""},null,40,le),[[x,l.calculated]])]),a("div",se,[a("button",{class:"button is-danger is-small mt-1",onClick:h(o=>M(r),["prevent"])}," Remove ",8,oe)]),d.value.components!==void 0?(i(),u("p",ne,_(d.value.components),1)):b("",!0)]))),128)),a("div",re,[a("button",{class:"button is-dark is-small",onClick:h(B,["prevent"])}," Add ")])])])],8,H)],32)])])],64))}};export{ve as default};
