import{l as I,r as k,b as H,o as e,c as l,a as t,t as d,u as g,k as a,F as D,f as j,h as M,j as V,e as P,_ as Q,i as U,p as G,m as J,d as A,g as N,q as W,n as X,w as R,R as Z}from"./index-7R5MiFNN.js";import{c as q}from"./BreadCrumb-DXLpQOAS.js";import{L as ee}from"./LoadingSkeleton-BnsbOEAN.js";import{t as te}from"./forms-CzZlnoB6.js";import{S}from"./sweetalert2.esm.all-CIewtpap.js";import{v as le}from"./index-DDdb-4WH.js";const se={class:"field"},oe=["for"],ne={class:"control"},ae={class:"select is-small",style:{width:"100%"}},ie=["name","id"],ce={key:0,value:""},re={key:1,value:""},ue={key:2,value:""},de=["value","selected"],_e={__name:"DynamicSelect",props:{item:Object},setup(F){const x=I(),m=F;let f=k(null),h=k(!1);return H(async()=>{try{const _=await q.collection(m.item.collection).getFullList({});f.value=_}catch(_){console.log(_.data),h.value=!0}}),(_,$)=>(e(),l("div",se,[t("label",{class:"label",for:F.item.name},[t("small",null,d(m.item.label),1)],8,oe),t("div",ne,[t("div",ae,[t("select",{name:m.item.name,id:m.item.name,style:{width:"100%"}},[g(f)===null&&!g(h)?(e(),l("option",ce," Data is loading... ")):a("",!0),g(h)?(e(),l("option",re," something error occured ")):a("",!0),g(h)?a("",!0):(e(),l("option",ue,d(m.item.firstOption),1)),g(h)?a("",!0):(e(!0),l(D,{key:3},j(g(f),w=>(e(),l("option",{value:w.id,selected:w.id===g(x).query[m.item.name]},d(w[m.item.labelField]),9,de))),256))],8,ie)])])]))}},fe={class:"columns is-multiline"},me={class:"column is-2"},pe={key:0,class:"field"},ve=["for"],he={class:"control"},ye=["id","name","value","placeholder"],be={key:1,class:"field"},ke=["for"],ge={class:"control"},xe={class:"select is-small",style:{width:"100%"}},$e=["name","id"],we=["value","selected"],Ce={__name:"Filter",props:{filter:Array,routeBack:{type:String,default:"/employee"},resetList:{type:Function,default:null}},setup(F){const x=F,m=M(),f=I();function h(){return x.filter.filter(o=>o.name==="text_search")[0].fields}function _(y,o){return o.filter(n=>n.name===y)[0]}async function $(y){y.preventDefault();const o=y.target,s=new FormData(o);let n=Object.fromEntries(s.entries());if(n=te(n),Object.keys(n).length===0)return;const p=[],C={};if(n.text_search!==void 0){const b=n.text_search;C.text_search=b,h().forEach(O=>{p.push(`${O}~'${b}'`)})}for(const[b,L]of Object.entries(n))b!="text_search"&&L!=""&&(C[b]=L,_(b,x.filter).type==="select"?p.push(`${b}="${L}"`):p.push(`${b}?~"${L}"`));const E=p.join("||");C.filter=E,m.push({path:x.routeBack,query:C})}function w(){m.push(f.path),x.resetList!==null&&x.resetList()}return(y,o)=>(e(),l("form",{novalidate:"",onSubmit:$},[t("div",fe,[(e(!0),l(D,null,j(x.filter,s=>(e(),l("div",me,[s.type==="text_search"?(e(),l("div",pe,[t("label",{class:"label",for:s.name},[t("small",null,d(s.label),1)],8,ve),t("div",he,[t("input",{id:s.name,class:"input is-small",name:s.name,value:g(f).query.text_search,type:"text",placeholder:s.placeholder},null,8,ye)])])):a("",!0),s.type==="select"?(e(),l("div",be,[t("label",{class:"label",for:s.name},[t("small",null,d(s.label),1)],8,ke),t("div",ge,[t("div",xe,[t("select",{name:s.name,id:s.name,style:{width:"100%"}},[(e(!0),l(D,null,j(s.options,n=>(e(),l("option",{value:n.value,selected:n.value===g(f).query[s.name]},d(n.label),9,we))),256))],8,$e)])])])):a("",!0),s.type==="relational_field_select"?(e(),V(_e,{key:2,item:s},null,8,["item"])):a("",!0)]))),256)),t("div",{class:"column is-12"},[t("div",{class:"field"},[t("div",{class:"control"},[o[0]||(o[0]=t("button",{class:"button is-dark is-small",type:"submit"},[t("i",{class:"bi bi-search pr-1"}),P(" Search ")],-1)),t("button",{class:"button is-secondary ml-2 is-small",onClick:w}," Reset ")])])])])],32))}},Le={key:1},Be={class:"box"},Fe={key:0,class:"box"},Se={class:"is-flex"},De={class:"has-text-weight-bold"},je={class:"scroll-div"},Oe={class:"has-text-grey"},Ee={key:0,class:"table is-fullwidth is-striped"},Ve=["checked","indeterminate"],qe=["value"],Ie=["onClick"],Ae={key:0},Ne={key:1},Re={key:2},He={key:3},Me={key:0},Pe={key:5},Te={key:2,class:"mt-4"},ze={key:0,class:"has-text-weight-bold"},Ye={key:3,class:"has-text-danger"},Ke={__name:"ListDisplay",props:{listHeader:Array,collection:String,filter:Array,detailViewLink:String,routeBack:{type:String},expand:{type:String,default:""}},setup(F){const x=M(),m=I(),f=k(!0),h=k(null),_=k(null),$=k(1),w=k("-created"),y=k(""),o=k([]),s=k(!1),n=k([]),p=F;async function C(r,c="-created",v="",i=!1){i||(f.value=!0);try{const B=await q.collection(p.collection).getList(r,5,{filter:v,sort:c,expand:p.expand});_.value=B,i?n.value.push(...B.items):(n.value=B.items,f.value=!1)}catch(B){f.value=!1,B.value="something error occured"}}H(()=>{b(m.query)}),U(()=>m.query,(r,c)=>{b(r)}),G(()=>{C($.value,w.value,y.value,s.value)});function E(){$.value<_.value.totalPages&&($.value+=1,s.value=!0)}function b(r){r.filter!==void 0&&(y.value=r.filter,$.value=1,s.value=!1)}function L(){n.value=[],$.value=1,y.value="",s.value=!1}function O(r,c){let v=[];for(let i=0;i<c.length;i++)r[c[i]]!==""&&v.push(r[c[i]]);return v.join(" ")}function T(r){const c=_.value.page,v=_.value.perPage;return(c-1)*v+(r+1)}function z(r){console.log("select all trigger"),r.target.checked?o.value=n.value:o.value=[]}async function Y(){if(!(await S.fire({title:"Are you sure want to delete?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#171717",cancelButtonColor:"#808080",confirmButtonText:"Yes, delete it!"})).isConfirmed||o.value.length===0)return;const c=q.createBatch();o.value.forEach((v,i)=>{c.collection(p.collection).delete(v.id)}),S.fire({title:"Data is deleting ...",allowOutsideClick:!1,didOpen:()=>{S.showLoading()}});try{await c.send(),C($.value,w.value,y.value),o.value=[],S.close()}catch(v){console.log(v),S.close(),S.fire({title:"Error!",text:v.data.message,icon:"error"}),o.value=[]}}function K(r){x.push(`${p.detailViewLink}/${r.id}`)}return(r,c)=>{const v=J("tempalte");return e(),l("div",null,[f.value?(e(),V(ee,{key:0})):a("",!0),!f.value&&h.value===null&&_.value?(e(),l("div",Le,[t("div",Be,[A(Ce,{filter:p.filter,routeBack:p.routeBack,resetList:L},null,8,["filter","routeBack"])]),o.value.length>0?(e(),l("div",Fe,[t("div",Se,[t("p",De,d(o.value.length)+" selected out of "+d(n.value.length),1),t("button",{class:"button is-danger is-small ml-4",onClick:Y},c[1]||(c[1]=[t("i",{class:"bi bi-archive pr-1"},null,-1),P(" Delete ")]))])])):a("",!0),N((e(),l("div",je,[t("p",Oe," Total Items: "+d(_.value.totalItems),1),n.value.length>0?(e(),l("table",Ee,[t("thead",null,[t("tr",null,[t("th",null,[t("input",{class:"custom-checkbox",onClick:z,type:"checkbox",checked:o.value.length===n.value.length,indeterminate:o.value.length>0&&o.value.length<n.value.length},null,8,Ve)]),(e(!0),l(D,null,j(p.listHeader,i=>(e(),l("th",null,d(i.label),1))),256))])]),t("tbody",null,[(e(!0),l(D,null,j(n.value,(i,B)=>(e(),l("tr",{key:i.id},[t("td",null,[N(t("input",{"onUpdate:modelValue":c[0]||(c[0]=u=>o.value=u),value:i,class:"custom-checkbox",type:"checkbox"},null,8,qe),[[W,o.value]])]),(e(!0),l(D,null,j(p.listHeader,u=>(e(),l("td",{class:X({"text-link":u.link}),onClick:Qe=>u.link&&K(i)},[u.type==="serial_number"?(e(),l("span",Ae,d(T(B)),1)):a("",!0),u.type==="text"?(e(),l("span",Ne,d(i[u.name]),1)):a("",!0),u.type==="combined"?(e(),l("span",Re,d(O(i,u.combinedField)),1)):a("",!0),u.type==="date"?(e(),l("span",He,d(i[u.name].split(" ")[0]),1)):a("",!0),u.type==="expand"?(e(),V(v,{key:4},{default:R(()=>[u.isCombinedField?(e(),l("span",Me,d(O(i.expand[u.expandCollection],u.fields)),1)):a("",!0)]),_:2},1024)):a("",!0),u.type==="action"?(e(),l("span",Pe,[A(g(Z),{class:"button is-dark",style:{width:"10px",height:"20px"},to:`/employee/edit/${i.id}`},{default:R(()=>c[2]||(c[2]=[t("i",{class:"bi bi-pencil",style:{"font-size":"10px"}},null,-1)])),_:2},1032,["to"])])):a("",!0)],10,Ie))),256))]))),128))])])):a("",!0)])),[[g(le),E]])])):a("",!0),!f.value&&h.value===null&&_.value?(e(),l("div",Te,[_.value.items.length===0?(e(),l("p",ze," no any data to show ")):a("",!0)])):a("",!0),h.value!==null?(e(),l("p",Ye,d(h.value),1)):a("",!0)])}}},et=Q(Ke,[["__scopeId","data-v-72b1778c"]]);export{et as L};
