import{_ as D,r as c,m as N,x as O,g as h,c as u,b as R,a as e,I as b,t as y,d as g,F as k,f as S,q as F,o as i,h as x,O as C,y as L,e as j,k as I}from"./index-DhUzF4e6.js";import{B as T}from"./BreadCrumb-QusY3eB5.js";import{S as P}from"./sweetalert2.esm.all-CIewtpap.js";const $={class:"card"},z={class:"card-content"},G=["disabled"],H={class:"columns is-multiline"},J={class:"column is-12"},K=["value"],Q={key:0,class:"has-text-danger mt-2"},W={class:"column is-12"},X={class:"column"},Y=["onUpdate:modelValue"],Z={key:0,id:"name_options"},ee=["value"],te={class:"column"},ae=["onUpdate:modelValue"],se={class:"column"},oe={class:"checkbox"},le=["onUpdate:modelValue","onChange"],ne={class:"column is-narrow"},re=["onClick"],ce={key:0,class:"has-text-danger mt-2"},ue={class:"is-flex is-flex-direction-row-reverse"},ie={__name:"Edit",setup(de){const n=c([]),v=c([]),p=c([]);c({});const V=c([]),d=c({}),_=c(!1),A=I(),f=F(),w=c(null);N(f.params,q,{immediate:!0});async function q(){try{const a=await h.collection("salary_structure").getOne(f.params.id);w.value=a,n.value.push(...a.components)}catch{}}O(async()=>{try{const a=await h.collection("salary_component").getFullList({});p.value=a,v.value=a,V.value=v.map(t=>t.abbreviation)}catch{}});function B(a){return v.value.length>0?v.value.filter(r=>r.name===a):[]}function E(){n.value.forEach(a=>{if(a.name!==""){const t=p.value.filter(r=>r.name!==a.name);p.value=t}}),n.value.push({name:"",amount:0,calculated:!1})}function M(a){n.value.length>1&&n.value.splice(a,1)}function U(a){const t=a.target,r=new FormData(t);let o=Object.fromEntries(r.entries());console.log(o,n.value),o.name===""&&(d.value.name="required field");const m=[];n.value.forEach(l=>{l.component=B(l.name)[0].id,m.push(l)}),m.length===0&&(d.value.components="required field");const s=m.map(l=>(l.amount===void 0&&(l.amount=0),l));_.value=!0;try{const l=h.collection("salary_structure").update(f.params.id,{name:o.name,components:s});P.fire({title:"Success!",text:"successfully updated",icon:"success"}),A.push("/payroll/salary_structure")}catch(l){console.log(l)}finally{_.value=!1}}return(a,t)=>{var r;return i(),u(k,null,[R(T,{links:[{label:"Dashboard",path:"/",isActive:!1},{label:"Payroll",path:"/payroll",isActive:!0},{label:"Salary Structure",path:"/payroll/salary_structure",isActive:!1},{label:"Add",path:"/payroll/salary_structure/add",isActive:!0}]}),e("div",$,[e("div",z,[e("form",{novalidate:"",onSubmit:b(U,["prevent"])},[e("fieldset",{disabled:_.value},[t[3]||(t[3]=e("legend",{class:"has-text-weight-bold"}," Add Salary Structure ",-1)),t[4]||(t[4]=e("div",{class:"is-flex is-flex-direction-row-reverse"},[e("button",{class:"button is-dark",type:"submit"}," Save ")],-1)),e("div",H,[e("div",J,[t[0]||(t[0]=e("label",{for:"name",class:"label"},"Name*",-1)),e("input",{type:"text",class:"input",id:"name",name:"name",value:(r=w.value)==null?void 0:r.name,required:""},null,8,K),d.value.name!==void 0?(i(),u("p",Q,y(d.value.name),1)):g("",!0)]),e("div",W,[t[2]||(t[2]=e("label",{class:"label"},"Components*",-1)),(i(!0),u(k,null,S(n.value,(o,m)=>(i(),u("div",{key:m,class:"columns"},[e("div",X,[x(e("input",{type:"text",class:"input","onUpdate:modelValue":s=>o.name=s,placeholder:"Salary component",list:"name_options",required:""},null,8,Y),[[C,o.name]]),p.value.length>0?(i(),u("datalist",Z,[(i(!0),u(k,null,S(p.value,s=>(i(),u("option",{value:s.name},y(s.name),9,ee))),256))])):g("",!0)]),e("div",te,[x(e("input",{type:"number",class:"input","onUpdate:modelValue":s=>o.amount=s,placeholder:"Amount",required:""},null,8,ae),[[C,o.amount]])]),e("div",se,[e("label",oe,[x(e("input",{type:"checkbox",class:"custom-checkbox","onUpdate:modelValue":s=>o.calculated=s,onChange:s=>{s.target.checked&&(o.amount=0)}},null,40,le),[[L,o.calculated]]),t[1]||(t[1]=j(" Based on formula "))])]),e("div",ne,[e("button",{class:"button is-danger is-small mt-1",onClick:b(s=>M(m),["prevent"])}," Remove ",8,re)]),d.value.components!==void 0?(i(),u("p",ce,y(d.value.components),1)):g("",!0)]))),128)),e("div",ue,[e("button",{class:"button is-dark is-small",onClick:b(E,["prevent"])}," Add ")])])])],8,G)],32)])])],64)}}},_e=D(ie,[["__scopeId","data-v-e848d5ef"]]);export{_e as default};
