import{g as R,r as b,m as C,c as v,b as U,u as N,p as D,d as w,a as d,I as $,e as A,t as L,q as F,o as k,L as j,k as H}from"./index-DhUzF4e6.js";import{B as O}from"./BreadCrumb-QusY3eB5.js";import{m as I,u as h,w as S,r as T}from"./utils-RVpx9FsL.js";import{S as V}from"./sweetalert2.esm.all-CIewtpap.js";import"./index.esm-DyswK6GF.js";async function G(l,a){l.name==="attendance"?await K(l,a):l.name==="advance_salary"?await P(l,a,"advance_salary_sample_import"):M(l,a)}async function K(l,a){const o=[];o.push(["Note: * field are required"]);const t=[],s=["id","created","updated"],m=["created","updated","employee","date"];if(l.fields.forEach(e=>{a==="new"?s.includes(e.name)||(e.required?t.push(`${e.name}*`):t.push(e.name)):m.includes(e.name)||(e.required?t.push(`${e.name}*`):t.push(e.name))}),o.push(t),a==="new"){t.splice(1,0,"employee_full_name"),t.splice(2,0,"employee_id");try{(await R.collection("employee").getFullList()).forEach(n=>{o.push([n.id,n.full_name,n.employee_id,I(),"","present"])})}catch{}}const c=h.aoa_to_sheet(o),r=h.book_new();h.book_append_sheet(r,c,"Sheet1");const p=S(r,{bookType:"xlsx",type:"array"}),y=new Blob([p],{type:"application/octet-stream"}),i=document.createElement("a");i.href=URL.createObjectURL(y),i.download="attendance_sample.xlsx",i.click(),URL.revokeObjectURL(i.href)}async function M(l,a){const o=[];o.push(["Note: * field are required"]);const t=[],s=["id","created","updated"],m=["created","updated"];l.fields.forEach(e=>{a==="new"?s.includes(e.name)||(e.required?t.push(`${e.name}*`):t.push(e.name)):m.includes(e.name)||(e.required?t.push(`${e.name}*`):t.push(e.name))}),o.push(t);const c=h.aoa_to_sheet(o),r=h.book_new();h.book_append_sheet(r,c,"Sheet1");const p=S(r,{bookType:"xlsx",type:"array"}),y=new Blob([p],{type:"application/octet-stream"}),i=document.createElement("a");i.href=URL.createObjectURL(y),i.download="sample.xlsx",i.click(),URL.revokeObjectURL(i.href)}async function P(l,a,o="sample"){const t=[];t.push(["Note: * field are required"]);const s=[],m=["id","created","updated"],c=["created","updated","employee","date"];if(l.fields.forEach(n=>{a==="new"?m.includes(n.name)||(n.required?s.push(`${n.name}*`):s.push(n.name)):c.includes(n.name)||(n.required?s.push(`${n.name}*`):s.push(n.name))}),t.push(s),a==="new"){s.splice(1,0,"employee_full_name"),s.splice(2,0,"employee_id");try{(await R.collection("employee").getFullList()).forEach(_=>{t.push([_.id,_.full_name,_.employee_id])})}catch{}}const r=h.aoa_to_sheet(t),p=h.book_new();h.book_append_sheet(p,r,"Sheet1");const y=S(p,{bookType:"xlsx",type:"array"}),i=new Blob([y],{type:"application/octet-stream"}),e=document.createElement("a");e.href=URL.createObjectURL(i),e.download=`${o}.xlsx`,e.click(),URL.revokeObjectURL(e.href)}async function W(l,a,o,t,s,m){const c=l.get("file");if(!c)return;const r=new FileReader;r.onload=p=>{const y=new Uint8Array(p.target.result),i=T(y,{type:"array"}),e=i.SheetNames[0],n=i.Sheets[e],_=h.sheet_to_json(n,{header:1,raw:!1}),f=_[1];console.log(f);const u=[];_.slice(2).forEach((q,ce)=>{if(q.length>0){const g={};q.forEach((B,x)=>{if(m.collection==="attendance"){if(x<6){const E=f[x].replace(/\*$/,"");g[E]=B}}else{const E=f[x].replace(/\*$/,"");g[E]=B}}),Object.keys(g).length>0&&u.push(g)}}),z(u,l,a,o,t,s,m)},r.readAsArrayBuffer(c)}async function z(l,a,o,t,s,m,c){l.forEach(r=>{try{R.collection(c.collection).create(r,{requestKey:null})}catch(p){console.log(p)}}),V.fire({title:"success",text:"succesfully uploaded",icon:"success"}),o(a)}const J={class:"container"},Q={key:1,class:"main"},X={class:"card"},Y={class:"card-content"},Z=["disabled"],ee=["disabled"],te={class:"file has-name is-info"},ae={class:"file-label"},se={class:"file-name"},oe={key:0,class:"mt-4"},le={key:1,class:"mt-4"},ne={key:2,class:"has-text-danger"},me={__name:"Add",setup(l){const a=F(),o=b(!1),t=b(null),s=b(null),m=b(!1),c=b(!1),r=b("No file uploaded"),p=b(null);H();async function y(){t.value=s.value=null,o.value=!0;try{const f=await R.send(`/api/get_collection/${a.params.collection}`);t.value=f.collection}catch(f){s.value=f.data.message}finally{o.value=!1}}C([a.params,a.query],y,{immediate:!0});async function i(){m.value=!0,await G(t.value,a.query.type),m.value=!1}async function e(f){c.value=!0;const u=new FormData(f.target);W(u,_,c,p,a.query.type,a.params)}function n(f){const u=f.target;r.value=u.files[0].name}function _(f){r.value="No file uploaded",c.value=!1}return(f,u)=>(k(),v("div",J,[U(O,{links:[{path:"/",label:"Dashboard",isActive:!1},{path:"/import",label:"Import",isActive:!1},{path:`/import/${N(a).params.collection}`,label:N(a).params.collection,isActive:!0}]},null,8,["links"]),o.value?(k(),D(j,{key:0})):w("",!0),t.value!==null?(k(),v("div",Q,[d("div",X,[d("div",Y,[d("button",{class:"button has-text-link",onClick:$(i,["prevent"]),disabled:m.value},u[0]||(u[0]=[A(" get sample file "),d("i",{class:"bi bi-arrow-right ml-2"},null,-1)]),8,Z),d("form",{class:"mt-3",onSubmit:$(e,["prevent"])},[d("fieldset",{disabled:c.value},[d("div",te,[d("label",ae,[d("input",{class:"file-input",type:"file",name:"file",onChange:n,required:""},null,32),u[1]||(u[1]=d("span",{class:"file-cta"},[d("span",{class:"file-icon"},[d("i",{class:"fas fa-upload"})]),d("span",{class:"file-label"},"Choose a fileâ€¦")],-1)),d("span",se,L(r.value),1)])]),u[3]||(u[3]=d("button",{class:"mt-2 button is-dark ml-3",type:"submit"}," Import ",-1)),c.value?(k(),v("div",oe,[u[2]||(u[2]=d("p",null,"Data is uploading ....",-1)),U(j)])):w("",!0),p.value!==null?(k(),v("div",le,L(p.value),1)):w("",!0)],8,ee)],32)])])])):w("",!0),s.value!==null?(k(),v("p",ne,L(s.value),1)):w("",!0)]))}};export{me as default};
